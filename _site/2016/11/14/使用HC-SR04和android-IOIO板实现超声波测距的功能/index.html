<!DOCTYPE html>
<html>
<head>

  <meta charset="UTF-8">
  <title>使用HC-SR04和android IOIO板实现超声波测距的功能</title>
  <meta name="viewport" content="width=device-width">

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="/assets/css/style.css" rel="stylesheet" />
  <link href="/assets/css/colors-dark.css" rel="stylesheet" />

</head>

<body>



  <header id="header">
    <h1><a href="/"><i class="icon-sun"></i> Solar Theme</a></h1>
    <p>A stylish blog using the Solarized color palette</p>
  </header>



  <div id="page">



    <div id="sidebar">
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archive</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="http://twitter.com/redwall_hp">Twitter</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
        </ul>
      </nav>
    </div>



    <div id="content">
      <article class="post">

	
		<h1><a href="/2016/11/14/%E4%BD%BF%E7%94%A8HC-SR04%E5%92%8Candroid-IOIO%E6%9D%BF%E5%AE%9E%E7%8E%B0%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D%E7%9A%84%E5%8A%9F%E8%83%BD/">使用HC-SR04和android IOIO板实现超声波测距的功能</a></h1>
	

	<div class="post-content"><div>
<div><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=&amp;url=http://album.sina.com.cn/pic/002o3oc9gy6QHbACELm88" target="_blank"><img title="" src="http://s9.sinaimg.cn/mw690/002o3oc9gy6QHbACELm88" alt="" /></a></div>
</div>
<p>可能是我在实现计时部分的逻辑实现的不够好，误差较大。</p>
<p>同样接好电路</p>
<p>开始编写代码，功能比较单一，因此代码也比较简单：</p>
<p>public class MainActivity extends IOIOActivity {</p>
<p>Button button;</p>
<p>private DigitalOutput led_;</p>
<p>private DigitalOutput vout;</p>
<p>private AnalogInput vin;</p>
<p>private TextView tv;</p>
<p>int flag,i;</p>
<p>long start,end;</p>
<p>@Override</p>
<p>public void onCreate(Bundle savedInstanceState) {</p>
<p>super.onCreate(savedInstanceState);</p>
<p>setContentView(R.layout.activity_main);</p>
<p>button=(Button)findViewById(R.id.button);</p>
<p>tv=(TextView)findViewById(R.id.textView2);</p>
<p>}</p>
<p>class Looper extends BaseIOIOLooper {</p>
<p>@Override</p>
<p>protected void setup() throws ConnectionLostException {</p>
<p>led_ = ioio_.openDigitalOutput(0,true);</p>
<p>vout= ioio_.openDigitalOutput(1,true);</p>
<p>vin=ioio_.openAnalogInput(40);</p>
<p>}</p>
<p>@Override</p>
<p>public void loop() throws ConnectionLostException, InterruptedException {</p>
<p>//Thread.sleep(1);</p>
<p>vout.write(true);</p>
<p>if(vin.read()&gt;0.5)</p>
<p>{</p>
<p>if(i==1)</p>
<p>{</p>
<p>start=System.nanoTime();</p>
<p>}</p>
<p>led_.write(true);</p>
<p>flag=2;</p>
<p>i++;</p>
<p>}</p>
<p>else</p>
<p>{</p>
<p>led_.write(false);</p>
<p>flag=flag-1;</p>
<p>end=System.nanoTime();</p>
<p>}</p>
<p>if(flag==1)</p>
<p>{</p>
<p>float time=end-start;</p>
<p>setNumber(time*340/2000000000);</p>
<p>flag=0;i=1;</p>
<p>}</p>
<p>}</p>
<p>}</p>
<p>@Override</p>
<p>protected IOIOLooper createIOIOLooper() {</p>
<p>return new Looper();</p>
<p>}</p>
<p>public void bt_Click(View v) throws ConnectionLostException{</p>
<p>led_.write(false);</p>
<p>vout.write(false);</p>
<p>flag=0;</p>
<p>i=1;</p>
<p>}</p>
<p>private void setNumber(float f) {</p>
<p>final String str = String.format("%.2f", f);</p>
<p>runOnUiThread(new Runnable() {</p>
<p>@Override</p>
<p>public void run() {</p>
<p>tv.setText("声波传递时间约为"+Float.parseFloat(str)*2000000000/340+"毫微秒，估算距离为"+str+"米");</p>
<p>}</p>
<p>});</p>
<p>}</p>
<p>}</p>
</div>

	<p class="meta">Posted on <span class="postdate">Nov 14, 2016</span></p>

</article>
    </div>



  </div>



  <footer id="footer">
    <p class="copyright">Copyright &copy; 2017 Solar Theme. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="http://www.webmaster-source.com">Matt Harzewski</a></p>
  </footer>



  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src="/assets/js/jquery.mobilemenu.min.js"></script>

  <script>
    $(document).ready(function(){
      $('#sidebar nav ul').mobileMenu({'topOptionText': 'Menu', 'prependTo': '#sidebar nav'});
    });
  </script>



</body>
</html>