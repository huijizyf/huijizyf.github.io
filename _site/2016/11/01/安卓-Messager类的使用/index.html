<!DOCTYPE html>
<html>
<head>

  <meta charset="UTF-8">
  <title>安卓 Messager类的使用</title>
  <meta name="viewport" content="width=device-width">

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="/assets/css/style.css" rel="stylesheet" />
  <link href="/assets/css/colors-dark.css" rel="stylesheet" />

</head>

<body>



  <header id="header">
    <h1><a href="/"><i class="icon-sun"></i> Solar Theme</a></h1>
    <p>A stylish blog using the Solarized color palette</p>
  </header>



  <div id="page">



    <div id="sidebar">
      <nav>
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/archives">Archive</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="http://twitter.com/redwall_hp">Twitter</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
        </ul>
      </nav>
    </div>



    <div id="content">
      <article class="post">

	
		<h1><a href="/2016/11/01/%E5%AE%89%E5%8D%93-Messager%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/">安卓 Messager类的使用</a></h1>
	

	<div class="post-content"><p><a href="http://photo.blog.sina.com.cn/showpic.html#blogid=8265bd790102vuam&amp;url=http://album.sina.com.cn/pic/002o3oc9gy6U9ZMbaBF8f" target="_blank"><img style="margin: 0px; padding: 0px; border: 0px; list-style: none;" title="安卓 &lt;wbr&gt;Messager类的使用" src="http://s16.sinaimg.cn/mw690/002o3oc9gy6U9ZMbaBF8f&amp;690" alt="安卓 &lt;wbr&gt;Messager类的使用" width="690" height="223" name="image_operate_39701437968139533" /></a><br />
（可以看到LogCat中已经打印出了从MainActivity发出的信息）</p>
<p>进行IPC（进程间通信）通信，一般写一个AIDL（安卓接口定义语言）接口，再写一个Service子类，然后实现AIDL接口 当做IBinder返回给Activity界面层。</p>
<p>单线程中与Service进行通信 Messenger类来处理，消息传递给Service进行通信。</p>
<p>Service的代码：</p>
<pre>public class <wbr />MyService <wbr />extends <wbr />Service {

private <wbr />Messenger <wbr />messenger <wbr />= <wbr />null;
private <wbr />Handler <wbr />handler <wbr />= <wbr />new <wbr />Handler(){
public void <wbr />handleMessage(android.os.Message msg) {
Log.d("MyService_Hanler", <wbr />"Msg:" <wbr />+ msg.what <wbr />+ <wbr />";" <wbr />+ msg.obj);
}
};
public <wbr />MyService() {
}
@Override
public void <wbr />onCreate() {
super.onCreate();
messenger <wbr />= <wbr />new <wbr />Messenger(handler);//获取Service中的Messager
}
@Override
public <wbr />IBinder <wbr />onBind(Intent arg0) {
return <wbr />messenger.getBinder();//取得Binder
}

}</pre>
<pre>Activity代码：</pre>
<pre></pre>
<pre>public class <wbr />MainActivity <wbr />extends <wbr />ActionBarActivity {

private <wbr />Messenger <wbr />messenger;
private <wbr />ServiceConnection <wbr />conn <wbr />= <wbr />new <wbr />ServiceConnection() {
@Override
public void <wbr />onServiceDisconnected(ComponentName cn) {
Log.d("MainActivity", <wbr />"ServiceDisconnected");
}
@Override
public void <wbr />onServiceConnected(ComponentName cn, <wbr />IBinder ibiner) {
messenger <wbr />= <wbr />new <wbr />Messenger(ibiner);//��取得Messenger
Log.d("MainActivity", <wbr />"Connect Success!!");
}
};
@Override
protected void <wbr />onCreate(Bundle savedInstanceState) {
super.onCreate(savedInstanceState);
setContentView(R.layout.activity_main);
bindService(new <wbr />Intent(this, <wbr />MyService.class), <wbr />conn, <wbr />Context.BIND_AUTO_CREATE);
}

public void <wbr />sendMsg(View view) {
if <wbr />(messenger <wbr />== <wbr />null) {
return;
}
Message msg1 = Message.obtain();
msg1.what <wbr />= <wbr />1;
msg1.obj <wbr />= <wbr />"I Send A Message I am MainActivity";
try <wbr />{
messenger.send(msg1);
} <wbr />catch <wbr />(RemoteException e) {
e.printStackTrace();
}
}
}</pre>
</div>

	<p class="meta">Posted on <span class="postdate">Nov 01, 2016</span></p>

</article>
    </div>



  </div>



  <footer id="footer">
    <p class="copyright">Copyright &copy; 2017 Solar Theme. Powered by <a href="http://jekyllrb.com">Jekyll</a>, theme by <a href="http://www.webmaster-source.com">Matt Harzewski</a></p>
  </footer>



  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
  <script src="/assets/js/jquery.mobilemenu.min.js"></script>

  <script>
    $(document).ready(function(){
      $('#sidebar nav ul').mobileMenu({'topOptionText': 'Menu', 'prependTo': '#sidebar nav'});
    });
  </script>



</body>
</html>